median(age.diff)
median(age.50_64)
median(age.65)
median(age.diff)
median(age.50_64,age.65)
0.7
XP<-0.7
XP<-c(XP,XP/2)
XP<-c(XP,XP/2)
XP<-c(XP,XP/2)
0.7+.35+.145+.0875+0.875/2
1.72*3
x<-0.7
y<-x+x/2
y
n<-0
10*.5
.5*.5
10*.25
.5*.5*.5
10*.125
n<-1
P<-0.7
value<-P*0.5^n
value<-P*0.5^n-1
value<-P*0.5^n+1
value<-P*0.5^(n-1)
n<-2
P<-0.7
value<-P*0.5^(n-1)
#P is principal
total<-0
for(i in 1:3){
P<-0.7
value<-P*0.5^(i-1)
total<-total+value
}
print(0.7+.35+.175)
current<-1.88
needed<-6-current
current<-1.88
needed<-6-current
for(i in 1:3){
value<-0.7*0.5^(i-1)
total<-total+value
needed<-needed-total
}
current<-1.88
needed<-6-current
for(i in 1:3){
value<-0.7*0.5^(i-1)
total<-total+value
}
needed<-needed-total
print(needed)
current<-1.88
needed<-6-current
for(i in 1:3){
value<-0.7*0.5^(i-1)
total<-total+value
}
needed<-needed-total
print(needed)
current<-1.88
needed<-6-current
total<-0
for(i in 1:3){
value<-0.7*0.5^(i-1)
total<-total+value
}
needed<-needed-total
print(needed)
current<-1.88
needed<-6-current
total<-0
for(i in 1:3){
value<-0.7*0.5^(i-1)
total<-total+value
}
needed<-needed-total
print(needed)
current<-1.88
needed<-6-current
total<-0
for(i in 1:8){
value<-0.7*0.5^(i-1)
total<-total+value
}
needed<-needed-total
print(needed)
load("C:/Users/beven/Desktop/MAB-RPath/MAB_model.RData")
load("C:/Users/beven/Desktop/MAB-RPath/MAB_model.RData")
load("C:/Users/beven/Desktop/MAB-RPath/MAB_model.csv")
load("C:/Users/beven/Desktop/MAB-RPath/MAB_model.RData")
View(MAB.rpath)
## Load libraries, packages and functions
library(Rpath); library(data.table);library(dplyr);library(here)
## Trophic level/Log biomass
trophic.lvl<-MAB.rpath$TL
log.biomass<-log10(biomass)
prebal<-as.data.frame(cbind(trophic.lvl,log.biomass))
row.names(prebal)<-groups
colnames(prebal)<-c("TL","LogB")
View(prebal)
## Select model groups only
prebal<-prebal[1:50,]
View(prebal)
## Run linear model
linear.model<-lm(log.biomass~trophic.lvl,data=prebal)
summary(linear.model)
View(prebal)
plot(log.biomass~trophic.lvl,data=prebal,pch=1,cex=0.001)
abline(linear.model)
text(log.biomass~trophic.lvl,data=prebal,labels=rownames(prebal),cex=0.5,font=2)
write.csv(MAB.rpath$EE,file="MAB_EE.csv")
##
## Last updated: 07 Sep 2021
##
## Email: brandon.beltz@stonybrook.edu
## ---------------------------
##
## Notes:
##
## ---------------------------
## Set Working directory
setwd("C:/Users/beven/Desktop/MAB-Rpath")
write.csv(MAB.rpath$EE,file="MAB_EE.csv")
## Prediction intervals
ints<-data.frame(trophic.lvl(min(trophic.lvl),max(TL)))
## Prediction intervals
ints<-data.frame(trophic.lvl=seq(min(trophic.lvl),max(TL)))
## Prediction intervals
ints<-data.frame(trophic.lvl=seq(min(trophic.lvl),max(trophic.level)))
## Prediction intervals
ints<-data.frame(trophic.lvl=seq(min(trophic.lvl),max(trophic.lvl)))
View(ints)
conf.band<-predict(eruption.lm,ints,interval="confidence")
prd.band<-predict(linear.model,ints,interval="predict")
lines(ints[,1],prd.band[,2],col=3)
lines(ints[,1],prd.band[,3],col=3)
## Plot SDs
sd2<-sd(abs(linear.model$residuals))*2
abline(linear.model$coefficients[1],linear.model$coefficients[2])
abline(linear.model$coefficients[1]+sd2,linear.model$coefficients[2])
abline(linear.model$coefficients[1]-sd2,linear.model$coefficients[2])
## Sum quarter trophic level
prebal<-as.data.frame(MAB.rpath$TL)
prebal<-cbind(prebal,biomass)
row.names(prebal)<-groups
colnames(prebal)<-c("TL","Biomass")
View(prebal)
View(prebal)
save.image("C:/Users/beven/Desktop/MAB-RPath/MAB_model.RData")
View(MAB.groups)
## Increase OtherCephalopod biomass by 30
biomass[27]<-biomass[27]*30
## Run model
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
## Balance adjustments
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Sum quarter trophic level
prebal<-as.data.frame(MAB.rpath$TL)
prebal<-cbind(prebal,biomass)
row.names(prebal)<-groups
colnames(prebal)<-c("TL","Biomass")
prebal<-prebal[1:50,]
prebal$rounded<-round(prebal$TL*4)/4
prebal<-aggregate(x=prebal$biomass,by=list(prebal$rounded),FUN=sum)
colnames(prebal)<-c("TL","Biomass")
prebal$log_biomass<-log10(prebal$biomass)
## Run linear model
linear.model<-lm(log.biomass~trophic.lvl,data=prebal)
summary(linear.model)
plot(log.biomass~trophic.lvl,data=prebal,pch=19,cex=1)
abline(linear.model)
View(MAB.Params)
## Biomass ratios
class<-MAB.params[,c(1:3)]
## Biomass ratios
class<-MAB.Params[,c(1:3)]
View(class)
new.biomass<-as.data.frame(cbind(groups,biomass),stringsAsFactors = F)
colnames(new.biomass)<-c("RPATH","New_biomass")
new.biomass$new.biomass<-as.numeric(new.biomass$new.biomass)
new.biomass$New.biomass<-as.numeric(new.biomass$New.biomass)
class<-left_join(class,new.biomass,by="RPATH")
View(class)
## Biomass ratios
## Sum by class
class<-MAB.Params[,c(1:3)]
View(class)
class<-aggregate(x=class$Biomass,by=list(class$Classification),FUN=sum)
colnames(class)<-c("Taxa","Biomass")
View(class)
View(MAB.Params)
load("C:/Users/beven/Desktop/MAB-RPath/data/MAB_params.RData")
View(MAB.Params)
View(MAB.Params)
MAB.Params[, "Demersal (round)" := "Demersal (Round)"
MAB.Params[, "Demersal (round)" := "Demersal (Round)"]
MAB.Params[, "Demersal (round)" := "Demersal (Round)"]
View(MAB.Params)
load("C:/Users/beven/Desktop/MAB-RPath/MAB_model.RData")
View(MAB.Params)
MAB.Params[c(3,8,11,25,41:42,45),3]<-"Demersal (Round)"
setwd("C:/Users/beven/Desktop/MAB-Rpath")
save(MAB.Params,"file=MAB_params.RData")
save(MAB.Params,file="MAB_params.RData")
save.image("C:/Users/beven/Desktop/MAB-RPath/MAB_model.RData")
##
## Last updated: 07 Sep 2021
##
## Email: brandon.beltz@stonybrook.edu
## ---------------------------
##
## Notes:
##
## ---------------------------
## Set Working directory
setwd("C:/Users/beven/Desktop/MAB-Rpath")
## Load libraries, packages and functions
library(Rpath); library(data.table);library(dplyr);library(here)
## Trophic level/Log biomass
trophic.lvl<-MAB.rpath$TL
log.biomass<-log10(biomass)
prebal<-as.data.frame(cbind(trophic.lvl,log.biomass))
row.names(prebal)<-groups
colnames(prebal)<-c("TL","LogB")
## Select model groups only
prebal<-prebal[1:50,]
## Run linear model
linear.model<-lm(log.biomass~trophic.lvl,data=prebal)
summary(linear.model)
plot(log.biomass~trophic.lvl,data=prebal,pch=1,cex=0.001)
abline(linear.model)
text(log.biomass~trophic.lvl,data=prebal,labels=rownames(prebal),cex=0.5,font=2)
## Prediction intervals
ints<-data.frame(trophic.lvl=seq(min(trophic.lvl),max(trophic.lvl)))
prd.band<-predict(linear.model,ints,interval="predict")
lines(ints[,1],prd.band[,2],col=3)
lines(ints[,1],prd.band[,3],col=3)
## Plot SDs
sd2<-sd(abs(linear.model$residuals))*2
abline(linear.model$coefficients[1],linear.model$coefficients[2])
abline(linear.model$coefficients[1]+sd2,linear.model$coefficients[2])
abline(linear.model$coefficients[1]-sd2,linear.model$coefficients[2])
## Sum quarter trophic level
prebal<-as.data.frame(MAB.rpath$TL)
prebal<-cbind(prebal,biomass)
row.names(prebal)<-groups
colnames(prebal)<-c("TL","Biomass")
prebal<-prebal[1:50,]
prebal$rounded<-round(prebal$TL*4)/4
prebal<-aggregate(x=prebal$biomass,by=list(prebal$rounded),FUN=sum)
colnames(prebal)<-c("TL","Biomass")
prebal$log_biomass<-log10(prebal$biomass)
## Run linear model
linear.model<-lm(log.biomass~trophic.lvl,data=prebal)
summary(linear.model)
plot(log.biomass~trophic.lvl,data=prebal,pch=19,cex=1)
abline(linear.model)
## Biomass ratios
## Sum by class
class<-MAB.Params[,c(1:3)]
text(log.biomass~trophic.lvl,data=prebal,labels=rownames(prebal),cex=0.5,font=2)
## Biomass ratios
## Sum by class
class<-MAB.Params[,c(1:3)]
class<-aggregate(x=class$Biomass,by=list(class$Classification),FUN=sum)
colnames(class)<-c("Taxa","Biomass")
## Demersal/medium pelagics:small pelagics
DM<-sum(class$Biomass[which(class$Taxa == "Demersal (Round)" | class$Taxa == "Demersal (Flat)")])
MP<-class$Biomass[which(class$Taxa == "Pelagic (Medium; Round)")]
SP<-sum(class$Biomass[which(class$Taxa == "Pelagic (Small; Round)" | class$Taxa == "Pelagic (Small)")])
DMP_SP<-(DM+MP)/SP
## Small pelagics:zooplankton
ZP<-class$Biomass[which(class$Taxa == "Zooplankton")]
SP_ZP<-SP/ZP
## Zooplankton:phytoplankton
PP<-class$Biomass[which(class$Taxa == "Primary Producer")]
ZP_PP<-ZP/PP
## Small pelagics:phytoplankton
SP_PP<-SP/PP
## Demersal:benthic invertebrates
BI<-class$Biomass[which(class$Taxa == "Invertebrate (Benthic)")]
DM_BI<-DM/BI
## Sharks/HMS:small pelagics
SH<-class$Biomass[which(class$Taxa == "Shark")]
HMS<-class$Biomass[which(class$Taxa == "HMS")]
SHMS_SP<-(SH+HMS)/SP
## Marine mammals/birds:small pelagics
MB<-sum(class$Biomass[which(class$Taxa == "Mammal" | class$Taxa == "Whale" | class$Taxa == "Bird")])
MB_SP<-MB/SP
## Whales:zooplankton
W<-class$Biomass[which(class$Taxa == "Whale")]
W_ZP<-W/ZP
## Ratio between fish aggregate groups
## Demersal:pelagics
PL<-MP+SP
DM_PL<-DM/PL
## Flatfish:roundfish
FF<-class$Biomass[which(class$Taxa == "Demersal (Flat)")]
RF<-class$Biomass[which(class$Taxa == "Demersal (Round)")]+MP+SP
FF_RF<-FF/RF
## Small pelagics: all fish
AF<-DM+MP+SP+HMS+SH
SP_AF<-SP/AF
## Medium pelagics:all fish
MP_AF<-MP/AF
## HMS:all fish
HMS_AF<-HMS/AF
## Sharks:all fish
SH_AF<-SH/AF
## Demersals:all fish
DM_AF<-DM/AF
## Ratio between invertebrate aggregate groups
PI<-class$Biomass[which(class$Taxa == "Invertebrate (Pelagic)")]
AI<-BI+ZP+PI
## Benthic invertebrate: all invertebrate
BI_AI<-BI/AI
## Zooplankton: all invertebrate
ZP_AI<-ZP/AI
## Pelagic invertebrate:all invertebrate
PI_AI<-PI/AI
## Other trophic ratios
## Zooplankton:benthos
ZP_BI<-ZP/BI
View(MAB.Params)
save.image("C:/Users/beven/Desktop/MAB-RPath/MAB_model.RData")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
View(MAB.groups)
## Increase OtherPelagics biomass by 140
biomass[29]<-biomass[29]*140
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
print(biomass)
## Increase OtherPelagics biomass by 140
biomass[29]<-biomass[29]/140
print(biomass)
load("C:/Users/beven/Desktop/MAB-RPath/MAB_model.RData")
MAB.rpath.params$model$Biomass
MAB.rpath.params$model$Biomass[29]
## Increase OtherPelagics biomass by 140
MAB.rpath.params$model$Biomass[29]<-MAB.rpath.params$model$Biomass[29]*140
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase OtherDemersals biomass by 390
MAB.rpath.params$model$Biomass[28]<-MAB.rpath.params$model$Biomass[28]*390
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase OtherCephalopods biomass by 1000
MAB.rpath.params$model$Biomass[27]<-MAB.rpath.params$model$Biomass[27]*1000
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase BlackSeaBass biomass by 10
MAB.rpath.params$model$Biomass[8]<-MAB.rpath.params$model$Biomass[8]*10
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase OtherShrimps biomass by 750
MAB.rpath.params$model$Biomass[30]<-MAB.rpath.params$model$Biomass[30]*750
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase SouthernDemersals biomass by 2
MAB.rpath.params$model$Biomass[42]<-MAB.rpath.params$model$Biomass[42]*2
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase AtlMackerel biomass by 90
MAB.rpath.params$model$Biomass[4]<-MAB.rpath.params$model$Biomass[4]*90
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase Megabenthos biomass by 50
MAB.rpath.params$model$Biomass[21]<-MAB.rpath.params$model$Biomass[21]*50
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase Cod biomass by 10
MAB.rpath.params$model$Biomass[11]<-MAB.rpath.params$model$Biomass[11]*10
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase SmFlatfishes biomass by 200
MAB.rpath.params$model$Biomass[39]<-MAB.rpath.params$model$Biomass[39]*200
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase SummerFlounder biomass by 1.5
MAB.rpath.params$model$Biomass[44]<-MAB.rpath.params$model$Biomass[44]*1.5
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase SmPelagics biomass by 40
MAB.rpath.params$model$Biomass[40]<-MAB.rpath.params$model$Biomass[40]*40
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase SmPelagics biomass by 40
MAB.rpath.params$model$Biomass[40]<-MAB.rpath.params$model$Biomass[40]*20
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase SmPelagics biomass by 40
MAB.rpath.params$model$Biomass[40]<-MAB.rpath.params$model$Biomass[40]/20
## Increase SmPelagics biomass by 40
MAB.rpath.params$model$Biomass[40]<-MAB.rpath.params$model$Biomass[40]/40
## Increase SmPelagics biomass by 40
MAB.rpath.params$model$Biomass[41]<-MAB.rpath.params$model$Biomass[41]*40
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase Windowpane biomass by 15
MAB.rpath.params$model$Biomass[47]<-MAB.rpath.params$model$Biomass[47]*15
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase WinterFlounder biomass by 25
MAB.rpath.params$model$Biomass[48]<-MAB.rpath.params$model$Biomass[48]*25
## Rerun model, check prebal diagnostics and save EEs
#source("MAB_prebal.R")
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Rerun model, check prebal diagnostics and save EEs
source("MAB_prebal.R")
## Increase WinterSkate biomass by 50
MAB.rpath.params$model$Biomass[49]<-MAB.rpath.params$model$Biomass[49]*50
## Rerun model, check prebal diagnostics and save EEs
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
#source("MAB_prebal.R")
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase LittleSkate biomass by 5
MAB.rpath.params$model$Biomass[18]<-MAB.rpath.params$model$Biomass[18]*5
## Rerun model, check prebal diagnostics and save EEs
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
#source("MAB_prebal.R")
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
## Increase SilverHake biomass by 30
MAB.rpath.params$model$Biomass[37]<-MAB.rpath.params$model$Biomass[37]*30
## Rerun model, check prebal diagnostics and save EEs
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
#source("MAB_prebal.R")
write.csv(MAB.rpath$EE,file="MAB_EE_temp.csv")
write.csv(MAB.rpath,file="MAB_model_b1.csv")
write.csv(MAB.rpath,file="MAB_model_b1.csv")
View(MAB.rpath)
## Trophic level/Log biomass
trophic.lvl<-MAB.rpath$TL
log.biomass<-log10(biomass)
prebal<-as.data.frame(cbind(trophic.lvl,log.biomass))
row.names(prebal)<-groups
colnames(prebal)<-c("TL","LogB")
## Select model groups only
prebal<-prebal[1:50,]
## Run linear model
linear.model<-lm(log.biomass~trophic.lvl,data=prebal)
summary(linear.model)
plot(log.biomass~trophic.lvl,data=prebal,pch=1,cex=0.001)
abline(linear.model)
text(log.biomass~trophic.lvl,data=prebal,labels=rownames(prebal),cex=0.5,font=2)
View(MAB.rpath.params)
View(MAB.rpath)
load("C:/Users/beven/Desktop/MAB-RPath/MAB_model.RData")
## Rerun model, check prebal diagnostics and save EEs
MAB.rpath<-rpath(MAB.rpath.params,eco.name='Mid-Atlantic Bight')
MAB.rpath
View(MAB.rpath)
